<% if !application_exists? %>
<section class="usa-section usa-section--light padding-y-3 margin-bottom-4" aria-label="Get started">
  <div class="grid-container">
    <div class="grid-row flex-column tablet:flex-row gap-4">
      <div class="usa-hero__callout grid-col">
        <h2 class="usa-hero__heading font-heading-xl">
          <%# TODO: handle this formatting stuff in the content so can pass the date %>
          <%# TODO: also '%b %d, %Y' doesn't correspond to a defined date format for locales, most similar to :short, but that doesn't have the year %>
          <span class="usa-hero__heading--alt"><%= t(".get_started.header") %></span> <%= certification.certification_requirements.due_date&.strftime('%b %d, %Y') %>
        </h2>
        <p class="text-base-lightest">
         <%= t(".get_started.prompt") %>
        </p>
        <%= link_to t(".get_started.button"), exemption_screener_path(certification_case_id: certification_case&.id), class: "usa-button" %>
      </div>

      <div class="grid-col display-flex flex-align-center">
        <p class="font-serif-md">
          <%= t(".get_started.info") %>
        </p>
      </div>
    </div>
  </div>
</section>
<% end %>

<div class="grid-container">
  <%# Current Period Compliance Status Section %>
  <h2 class="font-heading-xl margin-bottom-2">
    <%= t(".current_period.header", period: @current_period&.strftime("%B %Y")) %>
  </h2>
  <p class="margin-bottom-4">
    <%= t(".current_period.requirement_info", 
          target_hours: @target_hours, 
          period_end_date: @period_end_date&.strftime("%B %d, %Y")) %>
  </p>

  <%# Total Hours Reported %>
  <div class="margin-bottom-3">
    <p class="margin-bottom-05 text-base"><%= t(".current_period.total_hours_label") %></p>
    <p class="display-flex flex-align-center margin-top-0">
      <% if @hours_needed > 0 %>
        <svg class="usa-icon usa-icon--size-4 text-gold margin-right-1" aria-hidden="true" focusable="false" role="img">
          <use xlink:href="<%= asset_path('@uswds/uswds/dist/img/sprite.svg') %>#warning"></use>
        </svg>
      <% else %>
        <svg class="usa-icon usa-icon--size-4 text-green margin-right-1" aria-hidden="true" focusable="false" role="img">
          <use xlink:href="<%= asset_path('@uswds/uswds/dist/img/sprite.svg') %>#check_circle"></use>
        </svg>
      <% end %>
      <span class="font-body-lg text-bold"><%= t(".current_period.hours_value", hours: @total_hours_reported) %></span>
    </p>
  </div>

  <%# Additional Hours Needed %>
  <div class="margin-bottom-4">
    <p class="margin-bottom-05 text-base"><%= t(".current_period.additional_hours_label", target_hours: @target_hours) %></p>
    <% if @hours_needed > 0 %>
      <p class="display-flex flex-align-center margin-top-0">
        <svg class="usa-icon usa-icon--size-4 text-gold margin-right-1" aria-hidden="true" focusable="false" role="img">
          <use xlink:href="<%= asset_path('@uswds/uswds/dist/img/sprite.svg') %>#warning"></use>
        </svg>
        <span class="font-body-lg text-bold"><%= t(".current_period.hours_value", hours: @hours_needed) %></span>
      </p>
    <% else %>
      <div class="margin-top-0">
        <svg class="usa-icon usa-icon--size-4 text-green margin-right-05" aria-hidden="true" focusable="false" role="img" style="vertical-align: middle;">
          <use xlink:href="<%= asset_path('@uswds/uswds/dist/img/sprite.svg') %>#check_circle"></use>
        </svg>
        <span class="font-body-lg text-bold" style="vertical-align: middle;"><%= t(".current_period.requirements_met", period: @current_period&.strftime("%B %Y")) %></span>
      </div>
    <% end %>
  </div>

  <%# Action Buttons %>
  <div class="margin-bottom-4">
    <% if @hours_needed == 0 %>
      <%# Requirements met - show view activity report button %>
      <%= link_to t(".current_period.view_activity_report_button"), activity_report_application_form_path(activity_report), class: "usa-button" if activity_report.present? %>
    <% else %>
      <%# Requirements not met - show report activities and request exemption buttons %>
      <% if activity_report&.in_progress? %>
        <%= link_to t(".activity_report.continue_report_button"), activity_report_application_form_path(activity_report), class: "usa-button margin-right-2 margin-bottom-1" %>
      <% else %>
        <%= link_to t(".current_period.report_activities_button"), new_activity_report_application_form_path(certification_case_id: certification_case&.id), class: "usa-button margin-right-2 margin-bottom-1" %>
      <% end %>
      <% if exemption_application&.in_progress? %>
        <%= link_to t(".exemption_request.continue_request_button"), exemption_application_form_path(exemption_application), class: "usa-button usa-button--outline margin-bottom-1" %>
      <% else %>
        <%= link_to t(".current_period.request_exemption_button"), new_exemption_application_form_path(certification_case_id: certification_case&.id), class: "usa-button usa-button--outline margin-bottom-1" %>
      <% end %>
    <% end %>
  </div>

  <%# Previously Completed Requirements Section %>
  <h2 class="font-heading-lg margin-top-6 margin-bottom-2"><%= t(".previous_requirements.header") %></h2>
  <p class="margin-bottom-2"><%= t(".previous_requirements.intro") %></p>
  <%= link_to t(".previous_requirements.button"), certifications_path, class: "usa-button usa-button--outline" %>
</div>
